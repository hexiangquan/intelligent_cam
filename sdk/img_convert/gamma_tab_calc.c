#include "common.h"
#include <media/davinci/dm365_ipipe.h>
#include <math.h>

const int gamma_offset[] = {
	0,9,18,27,36,45,54,63,72,81,87,95,103,110,118,125,131,138,144,150,156,162,168,173,178,184,189,194,199,204,208,213,218,222,226,231,235,239,
	243,248,252,256,259,263,267,271,275,278,282,286,289,293,296,300,303,307,310,313,317,320,323,326,329,333,336,339,342,345,348,351,354,357,360,
	363,365,368,371,374,377,380,382,385,388,390,393,396,398,401,404,406,409,411,414,417,419,422,424,427,429,431,434,436,439,441,444,446,448,451,
	453,455,458,460,462,464,467,469,471,473,476,478,480,482,485,487,489,491,493,495,497,500,502,504,506,508,510,512,514,516,518,520,522,524,526,
	528,530,532,534,536,538,540,542,544,546,548,550,552,554,556,558,559,561,563,565,567,569,571,573,574,576,578,580,582,583,585,587,589,591,592,
	594,596,598,600,601,603,605,607,608,610,612,613,615,617,619,620,622,624,625,627,629,630,632,634,635,637,639,640,642,644,645,647,649,650,652,
	653,655,657,658,660,661,663,665,666,668,669,671,672,674,676,677,679,680,682,683,685,686,688,689,691,692,694,695,697,698,700,701,703,704,706,
	707,709,710,712,713,715,716,718,719,721,722,724,725,726,728,729,731,732,734,735,736,738,739,741,742,743,745,746,748,749,750,752,753,755,756,
	757,759,760,762,763,764,766,767,768,770,771,772,774,775,776,778,779,780,782,783,784,786,787,788,790,791,792,794,795,796,798,799,800,802,803,
	804,805,807,808,809,811,812,813,814,816,817,818,820,821,822,823,825,826,827,828,830,831,832,833,835,836,837,838,840,841,842,843,844,846,847,
	848,849,851,852,853,854,855,857,858,859,860,861,863,864,865,866,867,869,870,871,872,873,875,876,877,878,879,881,882,883,884,885,886,888,889,
	890,891,892,893,894,896,897,898,899,900,901,903,904,905,906,907,908,909,910,912,913,914,915,916,917,918,920,921,922,923,924,925,926,927,928,
	930,931,932,933,934,935,936,937,938,939,941,942,943,944,945,946,947,948,949,950,951,952,954,955,956,957,958,959,960,961,962,963,964,965,966,
	967,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,992,993,994,995,996,997,998,999,1000,1001,1002,
	1003,1004,1005,1006,1007,1008,1009,1010,1011,1012,1013,1014,1015,1016,,1017,1018,1019,1020,1021,1022,
};

int calc_gamma_table(struct ipipe_gamma_entry *entry, double gamma)
{
	int i;
	double lut, prev = 0.0;
	
	for(i = 0; i != sizeof(gamma_offset); ++i) {
		entry[i].offset = gamma_offset[i];
		lut = i;
		lut = lut * 8.0 / 4096;
		lut = pow(lut, gamma) * 1024;
		entry[i].slope = lut - prev;
	}

	return 0;
}

